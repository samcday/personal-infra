repositories:
- name: zalando
  url: https://opensource.zalando.com/postgres-operator/charts/postgres-operator
- name: mlohr
  url: https://helm-charts.mlohr.com/
- name: prometheus-community
  url: https://prometheus-community.github.io/helm-charts
- name: ingress-nginx
  url: https://kubernetes.github.io/ingress-nginx
- name: jetstack
  url: https://charts.jetstack.io
- name: vmware-tanzu
  url: https://vmware-tanzu.github.io/helm-charts

releases:
- name: hcloud-controller
  chart: mlohr/hcloud-cloud-controller-manager
  version: 2.4.1
  values:
  - manager:
      secret:
        create: true
      privateNetwork:
        enabled: true
        id: infra
        clusterSubnet: 10.233.255.0/24

  secrets:
  - secrets/hcloud-controller.yaml

- name: hcloud-csi-driver
  chart: mlohr/hcloud-csi-driver
  version: 1.1.3
  values:
  - csiDriver:
      secret:
        create: yes
  secrets:
  - secrets/hcloud-csi-driver.yaml

- name: ingress-nginx
  chart: ingress-nginx/ingress-nginx
  values:
  - controller:
      service:
        annotations:
          load-balancer.hetzner.cloud/location: nbg1
          load-balancer.hetzner.cloud/use-private-ip: "true"

- name: cert-manager
  chart: jetstack/cert-manager
  values:
  - installCRDs: true
    prometheus:
      servicemonitor:
        enabled: true

- name: velero
  chart: vmware-tanzu/velero
  # https://github.com/vmware-tanzu/helm-charts/blob/main/charts/velero/values.yaml
  values:
  - deployRestic: true
    initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.2.0
      volumeMounts:
      - mountPath: /target
        name: plugins
    configuration:
      provider: aws
      backupStorageLocation:
        name: default
        bucket: samcday-cluster-backups
        config:
          region: eu-central-003
          s3Url: https://s3.eu-central-003.backblazeb2.com
      volumeSnapshotLocation:
        name: default
        bucket: samcday-cluster-backups
        config:
          region: eu-central-003
          s3Url: https://s3.eu-central-003.backblazeb2.com
    metrics:
      serviceMonitor:
        enabled: true
    resources:
      requests:
        cpu: 100m
    restic:
      resources:
        requests:
          cpu: 250m
  secrets:
  - secrets/velero.yaml
- name: pgo-config
  chart: ./charts/pgo-config
  values:
  - endpoint: https://s3.eu-central-003.backblazeb2.com
  secrets:
  - secrets/pgo-config.yaml

- name: postgres-operator
  chart: zalando/postgres-operator
  version: 1.6.3
  values:
  - configKubernetes:
      enable_pod_disruption_budget: "false"
      pod_environment_configmap: default/postgres-pod-config
      pod_environment_secret: postgres-pod-secrets
  - configAwsOrGcp:
      aws_region: eu-central-003
      wal_s3_bucket: samcday-pgo

- name: grafana-agent
  chart: ./charts/grafana-agent
  values:
  - username: '166507'
  secrets:
  - secrets/grafana-agent.yaml

- name: kube-prometheus-stack
  chart: prometheus-community/kube-prometheus-stack
  version: 17.0.2
  # https://github.com/prometheus-community/helm-charts/blob/kube-prometheus-stack-17.0.2/charts/kube-prometheus-stack/values.yaml
  values:
  - defaultRules:
      create: false
    alertManager:
      enabled: false
    grafana:
      enabled: false
    prometheusOperator:
      enabled: false
    prometheus:
      enabled: false

- name: synapse
  chart: ./charts/synapse
  secrets:
  - secrets/synapse.yaml

- name: wekan
  chart: ./charts/wekan
  values:
  - image:
      tag: v5.41
    ingress:
      enabled: false
      annotations:
        kubernetes.io/ingress.class: nginx
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts:
        - host: wekan.samcday.com
      tls:
      - hosts:
        - wekan.samcday.com
        secretName: wekan-tls
    wekan:
      secrets:
        MONGO_URL: default/wekan-mongodb-admin-wekan
